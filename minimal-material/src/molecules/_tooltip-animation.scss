$-z-index: 1;

$-duration-in: 150ms !default;
$-delay-in: 150ms !default;

$-duration-out: 75ms !default;
$-delay-out: 75ms !default;

$-max: 1.5s !default;

/// Molecule
@mixin base(
  $z-index: $-z-index
) {
  z-index: $z-index;
  $props: clip-path, transform, opacity;
  will-change: $props;
  transition-property: $props;
}

/// Molecule
@mixin start() {
  clip-path: polygon(0 0, 0 0, 0 0, 0 0);
  transform: scale(0.5);
  opacity: 0;
}

/// Molecule
@mixin end($opacity: 1) {
  clip-path: polygon(0 0, 1000% 0, 1000% 1000%, 0 1000%);
  transform: scale(1);
  opacity: $opacity;
}

/// Molecule
@mixin timing-out(
  $duration: $-duration-in,
  $delay: $-delay-in,
) {
  transition: {
    delay: $delay, $delay + $duration, $delay;
    duration: $duration, 0s, $duration;  
    // delay: $delay;
    // duration: $duration;
  }
}

@mixin timing-in(
  $duration: $-duration-out,
  $delay: $-delay-out,
) {
  transition: {
    delay: $delay, $delay, 0s;
    duration: $duration, $duration, 0s;
    // delay: $delay;
    // duration: $duration;
  }
}

@mixin disappear-animation (
  $duration: $-duration-in,
  $max: $-max
) {
  animation: {
    duration: $duration;
    delay: $max;
    name: tooltip-hidding;
    fill-mode: forwards;
  };
}
/// Fusion
@mixin off(
  $duration: $-duration-out,
  $delay: $-delay-out,
  $z-index: $-z-index
) {
  @include timing-out($duration, $delay);
  @include start();
  @include base($z-index)
}

/// Fusion
@mixin on(
  $duration-in: $-duration-in,
  $duration-out: $-duration-out,
  $delay: $-delay-in,
  $max: $-max
) {
  @include timing-in($duration-in, $delay);

  //TODO Conflicts in Firefox with start-transition
  @supports not( -moz-appearance: none ) {
    @include disappear-animation($duration-out, $max);
  }

  @include end();
}

@keyframes tooltip-hidding {
  from {
    @include end();
  }
  99% {
    @include end(0);
  }
  to {
    @include start();
  }
}
